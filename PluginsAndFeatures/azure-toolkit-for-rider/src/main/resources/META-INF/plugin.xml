<!--
  ~ Copyright 2018-2023 JetBrains s.r.o. and contributors. Use of this source code is governed by the MIT license.
  -->

<idea-plugin xmlns:xi="http://www.w3.org/2001/XInclude" url="https://github.com/JetBrains/azure-tools-for-intellij">
  <id>com.intellij.resharper.azure</id>
  <name>Azure Toolkit for Rider</name>
  <vendor url="https://www.jetbrains.com">JetBrains</vendor>

  <xi:include href="/META-INF/azure-intellij-plugin-lib.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="/META-INF/azure-intellij-plugin-lib-dotnet.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="/META-INF/azure-intellij-resource-connector-lib.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="/META-INF/azure-intellij-plugin-service-explorer.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="/META-INF/azure-intellij-plugin-appservice.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="/META-INF/azure-intellij-plugin-appservice-dotnet.xml" xpointer="xpointer(/idea-plugin/*)"/>
  <xi:include href="/META-INF/azure-intellij-plugin-arm.xml" xpointer="xpointer(/idea-plugin/*)"/>

  <resource-bundle>messages.RiderAzureMessages</resource-bundle>

  <depends>com.intellij.modules.rider</depends>

  <extensions defaultExtensionNs="com.intellij">
    <applicationConfigurable parentId="tools"
                             displayName="Azure"
                             id="com.microsoft.intellij.AzureConfigurable"
                             instance="com.microsoft.azure.toolkit.intellij.settings.AzureConfigurable"/>

    <postStartupActivity implementation="com.microsoft.azure.toolkit.intellij.icons.RiderIconPatcherRegistrar"/>

    <dependencySupport kind="dotnet" coordinate="Microsoft.NET.Sdk.Functions" displayName="Azure Toolkit"/>
    <dependencySupport kind="dotnet" coordinate="Microsoft.Azure.Common" displayName="Azure Toolkit"/>
    <dependencySupport kind="dotnet" coordinate="Microsoft.Azure.Functions.Worker" displayName="Azure Toolkit"/>
    <dependencySupport kind="dotnet" coordinate="Microsoft.Azure.Storage.Common" displayName="Azure Toolkit"/>
    <dependencySupport kind="dotnet" coordinate="Microsoft.Azure.Storage.Blob" displayName="Azure Toolkit"/>
    <dependencySupport kind="dotnet" coordinate="Microsoft.Azure.WebJobs" displayName="Azure Toolkit"/>
    <dependencySupport kind="dotnet" coordinate="Microsoft.Identity.Client" displayName="Azure Toolkit"/>
    <dependencySupport kind="dotnet" coordinate="Microsoft.Identity.Web" displayName="Azure Toolkit"/>
    <dependencySupport kind="executable" coordinate="az"/>

    <errorHandler implementation="com.intellij.diagnostic.JetBrainsMarketplaceErrorReportSubmitter"/>
  </extensions>

  <extensions defaultExtensionNs="com.microsoft.tooling.msservices.intellij.azure">
    <actions implementation="com.microsoft.azure.toolkit.intellij.settings.IntellijCommonActionsContributor"/>
  </extensions>

  <applicationListeners>
    <listener class="com.microsoft.azure.toolkit.intellij.base.PluginLifecycleListener" topic="com.intellij.ide.AppLifecycleListener"/>
  </applicationListeners>

  <actions>
    <group id="AzurePopupGroup" text="Azure" description="Azure" icon="/icons/Rider/Azure.svg" popup="true">
      <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
      <reference ref="Connector.ShowAzureNode"/>
      <reference ref="AzureToolkit.ConnectToAzureResource"/>
    </group>

    <group id="AzureToolbarGroup" text="Azure" description="Azure">
      <add-to-group group-id="MainToolBar" anchor="last"/>
      <group id="PublishToAzureGroup" text="Publish Group" description="Publish Group" popup="true" icon="/icons/Publish_16.png">
          <reference ref="Actions.WebAppDeployAction"/>
      </group>
      <reference ref="Actions.AzureExplorerOpenAction"/>
      <reference ref="AzureToolkit.OpenResourceConnectionExplorerAction"/>
    </group>

    <group id="AzureToolkit.AzureActionGroup"
           class="com.intellij.openapi.actionSystem.DefaultActionGroup"
           text="Azure"
           description="Contains Azure tools plugin actions"
           icon="/icons/Rider/Azure.svg"
           popup="true">
        <add-to-group group-id="ToolsMenu" anchor="first"/>
        <reference ref="AzureToolkit.SelectSubscriptions"/>
        <separator/>
        <reference ref="Actions.WebAppDeployAction"/>
        <separator/>
        <reference ref="AzureToolkit.AzureSignIn"/>
    </group>
  </actions>

</idea-plugin>
